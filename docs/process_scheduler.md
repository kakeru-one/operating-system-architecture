# プロセススケジューラ
## 概要
- ひとつの論理CPU上で、同時に動けるプロセスの数はひとつ。
- プロセススケジューラは、論理CPUを複数のプロセスで交互に使用させるために、タイムスライス単位で切り替えを行う。
  - タイムスライスは、1つのプロセスにCPUリソースを渡す時間の事。

## コンテキストスイッチ
- 論理CPU上で動作するプロセスが切り替わることをコンテキストスイッチという。
- コンテキストスイッチは、プロセスがいかなるコードを実行中であろうとも、タイムスライスが切れると発生する。


## 並列実行
- **論理CPU（ハイパースレッディング含む）**が多くても、それに応じたプロセスやスレッドを実行しなければ、スループットは向上しない。
  - シングルスレッドプロセスの場合、論理CPUの数に近い数のプロセスを実行すると効果的。
  - マルチスレッドプロセスの場合、スレッドの総数が論理CPUの数に一致するように調整するのが理想的。
- 論理CPUの上限を超えてプロセスやスレッドを増やしても、スケジューラが順番に実行するため、オーバーヘッドが発生しスループットは上がらない。

### 具体例
- `4物理コア × 2スレッド（ハイパースレッディング）`（8つの論理CPU）だと、以下のプロセスの動かし方だと上限になる。
  - 8つのスレッドがすべての論理CPUに割り当てられるため、各スレッドが並列実行可能となる。
- 論理CPUの上限に達しているため、新しいスレッドやプロセスを追加した場合、スケジューラが順番に実行されるようになる。
  - 新しいスレッドやプロセスを追加した場合、スケジューラが時間を分割して切り替えながら実行するため、待ち時間が増え、スループットは向上しない。


```
プロセス1（以下のスレッドが動く）
  - スレッド1-A
  - スレッド1-B
  - スレッド1-C

プロセス2（以下のスレッドが動く）
  - スレッド2-A
  - スレッド2-B
  - スレッド2-C

プロセス3（シングルスレッド）

プロセス4（シングルスレッド）
```

### 蛇足（並行処理）
並行処理は、プロセススケジューラがCPUの時間をタイムスライスごとにプロセスに割り当てることで実現されている。

### 参考文献
- きよすけさんの記事が良かった。
  - https://qiita.com/Kiyo_Karl2/items/858f1b2b5ce55216c446
- https://zenn.dev/hsaki/books/golang-concurrency/viewer/term#%E3%80%8C%E4%B8%A6%E8%A1%8C%E3%80%8D%E3%81%A8%E3%80%8C%E4%B8%A6%E5%88%97%E3%80%8D%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%AE%E9%81%95%E3%81%84
